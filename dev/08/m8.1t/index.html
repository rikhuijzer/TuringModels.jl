<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m8.1t Â· TuringModels.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>TuringModels.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../intro/">Home</a></li><li><span class="toctext">Chapter 02</span><ul><li><a class="toctext" href="../../02/m2.1t/">m2.1t</a></li></ul></li><li><span class="toctext">Chapter 04</span><ul><li><a class="toctext" href="../../04/m4.2t/">m4.2t</a></li></ul></li><li><span class="toctext">Chapter 08</span><ul><li class="current"><a class="toctext" href>m8.1t</a><ul class="internal"></ul></li><li><a class="toctext" href="../m8.4t/">m8.4t</a></li></ul></li><li><span class="toctext">Chapter 10</span><ul><li><a class="toctext" href="../../10/m10.04t/">m10.04t</a></li></ul></li><li><span class="toctext">Chapter 11</span></li><li><span class="toctext">Chapter 12</span><ul><li><a class="toctext" href="../../12/m12.6t/">m12.6t</a></li></ul></li><li><a class="toctext" href="../../">Functions</a></li></ul></nav><article id="docs"><header><nav><ul><li>Chapter 08</li><li><a href>m8.1t</a></li></ul><a class="edit-page" href="https://github.com/StatisticalRethinkingJulia/TuringModels.jl/blob/master/docs/src/08/m8.1t.md"><span class="fa">ï‚›</span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>m8.1t</span><a class="fa fa-bars" href="#"></a></div></header><h3><a class="nav-anchor" id="m8.1stan-1" href="#m8.1stan-1">m8.1stan</a></h3><p>m8.1stan is the first model in the Statistical Rethinking book (pp. 249) using Stan.</p><p>Here we will use Turing&#39;s NUTS support, which is currently (2018) the originalNUTS by <a href="08/ http:/www.stat.columbia.edu/~gelman/research/published/nuts.pdf">Hoffman &amp; Gelman</a> and not the one that&#39;s in Stan 2.18.2, i.e., Appendix A.5 in: https://arxiv.org/abs/1701.02434</p><p>The TuringModels pkg imports modules such as CSV and DataFrames</p><pre><code class="language-julia">using TuringModels

Turing.setadbackend(:reverse_diff);
Turing.turnprogress(false)</code></pre><pre><code class="language-none">loaded


â”Œ Info: [Turing]: global PROGRESS is set as false
â”” @ Turing /Users/rob/.julia/packages/Turing/r03H1/src/Turing.jl:24





false</code></pre><p>Read in the <code>rugged</code> data as a DataFrame</p><pre><code class="language-julia">d = CSV.read(rel_path(&quot;..&quot;, &quot;data&quot;, &quot;rugged.csv&quot;), delim=&#39;;&#39;);</code></pre><p>Show size of the DataFrame (should be 234x51)</p><pre><code class="language-julia">size(d)</code></pre><pre><code class="language-none">(234, 51)</code></pre><p>Apply log() to each element in rgdppc_2000 column and add it as a new column</p><pre><code class="language-julia">d = hcat(d, map(log, d[Symbol(&quot;rgdppc_2000&quot;)]));</code></pre><p>Rename our col x1 =&gt; log_gdp</p><pre><code class="language-julia">rename!(d, :x1 =&gt; :log_gdp);</code></pre><p>Now we need to drop every row where rgdppc_2000 == missing</p><p>When this (https://github.com/JuliaData/DataFrames.jl/pull/1546) hits DataFrame it&#39;ll be conceptually easier: i.e., completecases!(d, :rgdppc_2000)</p><pre><code class="language-julia">notisnan(e) = !ismissing(e)
dd = d[map(notisnan, d[:rgdppc_2000]), :];</code></pre><p>Updated DataFrame dd size (should equal 170 x 52)</p><pre><code class="language-julia">size(dd)</code></pre><pre><code class="language-none">(170, 52)</code></pre><p>Define the Turing model</p><pre><code class="language-julia">@model m8_1stan(y, xâ‚, xâ‚‚) = begin
    Ïƒ ~ Truncated(Cauchy(0, 2), 0, Inf)
    Î²R ~ Normal(0, 10)
    Î²A ~ Normal(0, 10)
    Î²AR ~ Normal(0, 10)
    Î± ~ Normal(0, 100)

    for i âˆˆ 1:length(y)
        y[i] ~ Normal(Î± + Î²R * xâ‚[i] + Î²A * xâ‚‚[i] + Î²AR * xâ‚[i] * xâ‚‚[i], Ïƒ)
    end
end;</code></pre><p>Test to see that the model is sane. Use 2000 for now, as in the book. Need to set the same stepsize and adapt_delta as in Stan...</p><p>Use Turing mcmc</p><pre><code class="language-julia">posterior = sample(m8_1stan(dd[:log_gdp], dd[:rugged], dd[:cont_africa]),
Turing.NUTS(2000, 1000, 0.95));</code></pre><pre><code class="language-none">â”Œ Info: [Turing] looking for good initial eps...
â”” @ Turing.Inference /Users/rob/.julia/packages/Turing/r03H1/src/inference/support/hmc_core.jl:240
[NUTS{Turing.Core.FluxTrackerAD,Union{}}] found initial Ïµ: 0.1
â”” @ Turing.Inference /Users/rob/.julia/packages/Turing/r03H1/src/inference/support/hmc_core.jl:235
â”Œ Info:  Adapted Ïµ = 0.026392788491123437, std = [1.0, 1.0, 1.0, 1.0, 1.0]; 1000 iterations is used for adaption.
â”” @ Turing.Inference /Users/rob/.julia/packages/Turing/r03H1/src/inference/adapt/adapt.jl:91


[NUTS] Finished with
  Running time        = 223.3260227410002;
  #lf / sample        = 0.0;
  #evals / sample     = 46.4005;
  pre-cond. metric    = [1.0, 1.0, 1.0, 1.0, 1.0].</code></pre><p>Fix the inclusion of adaptation samples</p><pre><code class="language-julia">draws = 1001:2000
posterior2 = Chains(posterior[draws,:,:], :parameters)</code></pre><pre><code class="language-none">Object of type Chains, with data of type 1000Ã—5Ã—1 Array{Union{Missing, Float64},3}

Log evidence      = 0.0
Iterations        = 1001:2000
Thinning interval = 1
Chains            = Chain1
Samples per chain = 1000
parameters        = Ïƒ, Î²AR, Î²A, Î±, Î²R

parameters
      Mean    SD   Naive SE  MCSE     ESS  
  Î±  9.2258 0.1457   0.0046 0.0097 224.9403
 Î²A -1.9580 0.2372   0.0075 0.0164 209.5267
Î²AR  0.3969 0.1330   0.0042 0.0100 175.8492
 Î²R -0.2038 0.0797   0.0025 0.0055 212.8302
  Ïƒ  0.9500 0.0509   0.0016 0.0017 916.8077</code></pre><p>Example of a Turing run simulation output</p><p>Here&#39;s the ulam() output from rethinking</p><pre><code class="language-julia">m8_1s_cmdstan = &quot;
Iterations = 1:1000
Thinning interval = 1
Chains = 1,2,3,4
Samples per chain = 1000

Empirical Posterior Estimates:
          Mean         SD       Naive SE       MCSE      ESS
    a  9.22360053 0.139119116 0.0021996664 0.0034632816 1000
   bR -0.20196346 0.076106388 0.0012033477 0.0018370185 1000
   bA -1.94430980 0.227080488 0.0035904578 0.0057840746 1000
  bAR  0.39071684 0.131889143 0.0020853505 0.0032749642 1000
sigma  0.95036370 0.052161768 0.0008247500 0.0009204073 1000

Quantiles:
          2.5%       25.0%       50.0%      75.0%        97.5%
    a  8.95307475  9.12719750  9.2237750  9.31974000  9.490234250
   bR -0.35217930 -0.25334425 -0.2012855 -0.15124725 -0.054216855
   bA -2.39010825 -2.09894500 -1.9432550 -1.78643000 -1.513974250
  bAR  0.13496995  0.30095575  0.3916590  0.47887625  0.650244475
sigma  0.85376115  0.91363250  0.9484920  0.98405750  1.058573750
&quot;;</code></pre><p>Describe the posterior samples</p><pre><code class="language-julia">describe(posterior2)</code></pre><pre><code class="language-none">Log evidence      = 0.0
Iterations        = 1001:2000
Thinning interval = 1
Chains            = Chain1
Samples per chain = 1000
parameters        = Ïƒ, Î²AR, Î²A, Î±, Î²R



â”Œ Warning: `quantile(v::AbstractArray{&lt;:Real})` is deprecated, use `quantile(v, [0.0, 0.25, 0.5, 0.75, 1.0])` instead.
â”‚   caller = (::getfield(MCMCChains, Symbol(&quot;##102#104&quot;)){Chains{Union{Missing, Float64},Float64,NamedTuple{(:parameters,),Tuple{Array{String,1}}},NamedTuple{(:hashedsummary,),Tuple{Base.RefValue{Tuple{UInt64,MCMCChains.ChainSummaries}}}}}})(::String) at none:0
â”” @ MCMCChains ./none:0


[36m[1mEmpirical Posterior Estimates[22m[39m
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
parameters
      Mean    SD   Naive SE  MCSE     ESS  
  Î±  9.2258 0.1457   0.0046 0.0097 224.9403
 Î²A -1.9580 0.2372   0.0075 0.0164 209.5267
Î²AR  0.3969 0.1330   0.0042 0.0100 175.8492
 Î²R -0.2038 0.0797   0.0025 0.0055 212.8302
  Ïƒ  0.9500 0.0509   0.0016 0.0017 916.8077

[36m[1mQuantiles[22m[39m
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
parameters
      2.5%   25.0%   50.0%   75.0%   97.5% 
  Î±  8.6704  9.1249  9.2246  9.3219  9.7520
 Î²A -2.6922 -2.1177 -1.9737 -1.7884 -1.2476
Î²AR -0.0845  0.3022  0.3964  0.4840  0.8435
 Î²R -0.4696 -0.2584 -0.2024 -0.1488  0.0564
  Ïƒ  0.7990  0.9121  0.9494  0.9842  1.1318</code></pre><p>end of 08/m8.1t.jl#- <em>This notebook was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../../04/m4.2t/"><span class="direction">Previous</span><span class="title">m4.2t</span></a><a class="next" href="../m8.4t/"><span class="direction">Next</span><span class="title">m8.4t</span></a></footer></article></body></html>
